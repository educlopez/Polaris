---
import { getCollection, render, type CollectionEntry } from "astro:content";
import Layout from "@/layouts/layout-principal.astro";
import { Image } from "astro:assets";

export async function getStaticPaths() {
  const projects = await getCollection("projects");
  return projects.map((entry) => ({
    params: { id: entry.id },
    props: { entry },
  }));
}

interface Props {
  entry: CollectionEntry<"projects">;
}

const { entry } = Astro.props;
const { Content } = await render(entry);
const project = entry.data;
import siteConfig from "@/config/site.json";
const { company } = siteConfig;
import { X } from "@lucide/astro";
import { Button } from "@/components/ui/button";
---

<Layout title={`${project.name} Case Study | Endless`}>
  <Fragment slot="left-content">
    <div class="flex w-full flex-col gap-6 lg:sticky lg:top-4">
      <div class="flex items-center gap-2 mb-2">
        <a
          href="/"
          class="text-sm text-muted-foreground hover:text-foreground transition-colors"
        >
          ‚Üê Back to projects
        </a>
      </div>
      <div class="flex flex-row gap-2 items-center">
        <a href="/" class="w-8 h-8">
          <Image
            src={company.logo}
            alt={company.name}
            width="32"
            height="32"
            class="rounded-full object-cover w-full h-full"
          />
        </a>
        <X />
        <div class="w-8 h-8">
          <Image
            src={project.logo.image}
            alt={project.name}
            width="32"
            height="32"
            class="rounded-full object-cover w-full h-full"
          />
        </div>
      </div>
      <div class="flex flex-col gap-3">
        <h1 class="text-balance font-semibold text-2xl">
          {project.name}
        </h1>
        <p class="text-sm">{project.description}</p>
      </div>
      {
        project.caseStudy.links && (
          <div class="flex items-center gap-3">
            {project.caseStudy.links.map((link) => (
              <a href={link.url}>
                <Button>{link.text}</Button>
              </a>
            ))}
          </div>
        )
      }
    </div>
  </Fragment>
  <Fragment slot="right-content">
    <Image
      src={project.cover}
      alt={project.coverAlt}
      width="1200"
      height="675"
      class="w-full aspect-video object-cover rounded-xl mb-12"
      transition:name={`project-${entry.id}`}
    />
    <div class="grid gap-12">
      <article class="prose-custom">
        <Content />
      </article>
    </div>
  </Fragment>
</Layout>
